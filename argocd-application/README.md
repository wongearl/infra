# 多集群
## get k8s secret
### create admin sa
```
apiVersion: v1
kind: ServiceAccount
metadata:
  name: argocd-admin
  namespace: kube-system
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: argocd-admin
subjects:
  - kind: ServiceAccount
    name: dashboard-admin
    namespace: kube-system
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
```
### get secret
```
kubectl get secret argocd-admin-token-9rcqj -n kube-system -oyaml
apiVersion: v1
data:
  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1URXlNekE1TkRjd09Gb1hEVE16TVRFeU1EQTVORGN3T0Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTE0xCmdHY3p2NVpBMmJRcDUvWjhsM3BJT0ZBTWpKRlYyOFlUc0QrbUErQTlCYWVYM3cwOWJwdTBsbG5VOXMyM29iL2gKckgzVGw1cTZ2c0ZtWFlud3FrdEtiUDc5SDJ2bnlJWDFxUGNTdjRNKzRkMFYvaFNsVnd6b0hNY2xrMkcyTXIwRApNQmNKTlVmelNQVTRoK010cFg2Si9RV0wwalQ5STVRNWg5b1BMbkxxaWtCMnphcHNETHBCeUcwSFk1YnptZXQ4ClJpOUZDQnJzYTR1Y1hvZVZkR2hZRmlzOW84Tk1tb1JxalpXUlVhY2dNV1ovVXBXYU5rYUpJSDd0Y0wwbGRjbXMKdFZ4QkNXbnVIajNjeUVKbzlFY0tPVkhDdklDMDVpTDlnUlBnY0k5aFdHRHZLZ0RqNS9ObWwvQy9kNmp3aGY5Rgo3SUl4eFl6emhpWXBodHJPN1gwQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZQNHZ0YXFCOU9oakRTaThsTFBJam1jaERyYjhNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSHpuayttcTkyV1dvNVNSSFFRRwo1bERvRHo3TFVXREd0R2FBVG1maURTdyt5NFZwN0hHc2hTN1BiNnpzYkpKNC9xYW4yQWpadndjV2xLd0NkZ1FZClNxbzZKazFQeFIxZ0pxRWtBSDZTcno3eXc4VDFORHhCOXZ4RE1FZTE5NTBMaXNpblI0TGxtQ3poUDVuaDVOTmQKTUtTcmZrRVkweUJkWXBRQy84N3pwSFltTXdHVFJrYTYxTWxyYXdaS0UveGxUcytjWDM2T3p6bWtTSmpCZ0ZrTApFT1dWV1ZnNStKZG9IWUhDeWxqZFR2MEM1eGJPdEhRU05HcHZqVFB4NUF3N0pVSVB6dVFkVDRhWUhOelRNS2dYCngxUXhTSGg3bEVjWlJ5MEF2VzFvZXhON0pjS25mUzFVU3FQNXRMQUM0d2NRUGZMK0FCRmtqd3oyNVJNNndYeDgKNUIwPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  namespace: a3ViZS1zeXN0ZW0=
  token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNklsVmtUbTAxYW1ScFNGVXlVVXczYmt0R1l6ZGhNbWx2YzA0eGFXMWFNRzlKUm1KR1JFSTJTMUpGTjJNaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUpyZFdKbExYTjVjM1JsYlNJc0ltdDFZbVZ5Ym1WMFpYTXVhVzh2YzJWeWRtbGpaV0ZqWTI5MWJuUXZjMlZqY21WMExtNWhiV1VpT2lKaGNtZHZZMlF0WVdSdGFXNHRkRzlyWlc0dE9YSmpjV29pTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1dVlXMWxJam9pWVhKbmIyTmtMV0ZrYldsdUlpd2lhM1ZpWlhKdVpYUmxjeTVwYnk5elpYSjJhV05sWVdOamIzVnVkQzl6WlhKMmFXTmxMV0ZqWTI5MWJuUXVkV2xrSWpvaVpEY3dNbVU0TW1ZdE4yTTJOeTAwTjJSaUxXSTJNbVV0TkRVeE9HSTNZelEzTUdSa0lpd2ljM1ZpSWpvaWMzbHpkR1Z0T25ObGNuWnBZMlZoWTJOdmRXNTBPbXQxWW1VdGMzbHpkR1Z0T21GeVoyOWpaQzFoWkcxcGJpSjkua1VYOVVyOGJWWTlTYThNNHFrdGxCd1ZBbzE3a2JHUDQ2WTBleUhyZ2dFeFljdGwxYnE0S0hwXzdfSlpxMjJDQ2Q4Q0ljdHpNTV9WU2FZYmxuSFFzUkd3eDhfQUpsUzc3TWhaTU5hNjA5R3Bwd2swaVJITGtrWW9Sd2lLckVfWVl6SkZhUmNIYmNhVVNDS3RtTGxwcG5ta1FFOHdwdktWbzFLZ3NRLXE0NzVwUkdacjNSM2VJNzJyd2VfS0hpNzM4aTZhckkwbnJuWXRzNk5BRWQzVEJWUzk2eGFtci1HSjBFSW1yUlpFaXVNNm1CQUxsanIxUzY5ZlZqVnUwUFdOSlg3TmJVUnVZRnRzVVI2VHgzT2xEUkpabG1IN284V2gzMjlNa3o1N1hfMVNZLXZzYWJmdjdDaC1Qa3VETURJaEVLMGZpaGFpUGZkemdFT0dXZHBGd1Z3
kind: Secret
metadata:
  annotations:
    kubernetes.io/service-account.name: argocd-admin
    kubernetes.io/service-account.uid: d702e82f-7c67-47db-b62e-4518b7c470dd
  creationTimestamp: "2023-11-24T01:23:34Z"
  name: argocd-admin-token-9rcqj
  namespace: kube-system
  resourceVersion: "66705"
  uid: 111be69e-3393-405f-af1a-4c59aea2819a
type: kubernetes.io/service-account-toke
```
## create secret in the k8s have deploy argocd

> copy argocd-admin-token-9rcqj.data.token to cluster-dev.stringData.config.bearerToken(after decode)
> copy argocd-admin-token-9rcqj.data.ca.crt to cluster-dev.stringData.config.tlsClientConfig.caData
```
apiVersion: v1
kind: Secret
metadata:
  name: cluster-dev
  namespace: argocd
  labels:
    argocd.argoproj.io/secret-type: cluster
type: Opaque
stringData:
  name: dev
  server: https://172.11.0.208:6443
  config: |
    {
      "bearerToken": "eyJhbGciOiJSUzI1NiIsImtpZCI6IlVkTm01amRpSFUyUUw3bktGYzdhMmlvc04xaW1aMG9JRmJGREI2S1JFN2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4taG1uZjIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiMzJkZWFiNjMtMjYyZC00MDIwLWEyZTctMzUzODJlYjU0YTg0Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.ABQqPrBdnU2oSKLggqpGFie4_cLFALpYXmTrrkkW7m4U1iMpVJRALzny--1nyxoTfJwuLeBzW-BtKBB0yVqG5G3Kbu18d9kGtx0QL-wZOe0JzKxrCiJVjSYXsVo8ETtTtJrdmA2FLWUHZJSBjvItkIpvVCrJIQX3gvRMT0xE4Js6ryo4VwL38GQbRzcgtUMrtw9hKrEriOtdJzfi-AbR3lrkeem4MPzI30L5GpnCAs4HJid0l-PaeiZ20aHO0z2H_8sw8aAIkO-1ELrtkTxP0Ox4wf_xwxvTgpDXuzHoASeGMiaUUSjyv4_RiZ1fOQrbj8Xq0xlrhs9LGTbWDgdKQA",
      "tlsClientConfig": {
        "insecure": false,
        "caData": "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1URXlNekE1TkRjd09Gb1hEVE16TVRFeU1EQTVORGN3T0Zvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTE0xCmdHY3p2NVpBMmJRcDUvWjhsM3BJT0ZBTWpKRlYyOFlUc0QrbUErQTlCYWVYM3cwOWJwdTBsbG5VOXMyM29iL2gKckgzVGw1cTZ2c0ZtWFlud3FrdEtiUDc5SDJ2bnlJWDFxUGNTdjRNKzRkMFYvaFNsVnd6b0hNY2xrMkcyTXIwRApNQmNKTlVmelNQVTRoK010cFg2Si9RV0wwalQ5STVRNWg5b1BMbkxxaWtCMnphcHNETHBCeUcwSFk1YnptZXQ4ClJpOUZDQnJzYTR1Y1hvZVZkR2hZRmlzOW84Tk1tb1JxalpXUlVhY2dNV1ovVXBXYU5rYUpJSDd0Y0wwbGRjbXMKdFZ4QkNXbnVIajNjeUVKbzlFY0tPVkhDdklDMDVpTDlnUlBnY0k5aFdHRHZLZ0RqNS9ObWwvQy9kNmp3aGY5Rgo3SUl4eFl6emhpWXBodHJPN1gwQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZQNHZ0YXFCOU9oakRTaThsTFBJam1jaERyYjhNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSHpuayttcTkyV1dvNVNSSFFRRwo1bERvRHo3TFVXREd0R2FBVG1maURTdyt5NFZwN0hHc2hTN1BiNnpzYkpKNC9xYW4yQWpadndjV2xLd0NkZ1FZClNxbzZKazFQeFIxZ0pxRWtBSDZTcno3eXc4VDFORHhCOXZ4RE1FZTE5NTBMaXNpblI0TGxtQ3poUDVuaDVOTmQKTUtTcmZrRVkweUJkWXBRQy84N3pwSFltTXdHVFJrYTYxTWxyYXdaS0UveGxUcytjWDM2T3p6bWtTSmpCZ0ZrTApFT1dWV1ZnNStKZG9IWUhDeWxqZFR2MEM1eGJPdEhRU05HcHZqVFB4NUF3N0pVSVB6dVFkVDRhWUhOelRNS2dYCngxUXhTSGg3bEVjWlJ5MEF2VzFvZXhON0pjS25mUzFVU3FQNXRMQUM0d2NRUGZMK0FCRmtqd3oyNVJNNndYeDgKNUIwPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg=="
      }
    }
```